apiVersion: sme.sap.com/v1alpha1
kind: CAPTenant
metadata:
  generation: 3
  finalizers:
    - sme.sap.com/captenant
  annotations:
    sme.sap.com/btp-app-identifier: btp-glo-acc-id.test-cap-01
    sme.sap.com/owner-identifier: default.test-cap-01
  labels:
    sme.sap.com/btp-app-identifier-hash: f20cc8aeb2003b3abc33f749a16bd53544b6bab2
    sme.sap.com/btp-tenant-id: tenant-id-for-provider
    sme.sap.com/owner-generation: "2"
    sme.sap.com/owner-identifier-hash: 1f74ae2fbff71a708786a4df4bb2ca87ec603581
    sme.sap.com/tenant-type: provider
  name: test-cap-01-provider
  namespace: default
  ownerReferences:
    - apiVersion: sme.sap.com/v1alpha1
      blockOwnerDeletion: true
      controller: true
      kind: CAPApplication
      name: test-cap-01
      uid: 3c7ba7cb-dc04-4fd1-be86-3eb3a5c64a98
spec:
  capApplicationInstance: test-cap-01
  subDomain: my-changed-provider
  tenantId: tenant-id-for-provider
  version: 8.9.10
  versionUpgradeStrategy: always
status:
  conditions:
    - message: "VirtualService (and DestinationRule) default.test-cap-01-provider was reconciled"
      reason: TenantNetworkingModified
      observedGeneration: 3
      status: "True"
      type: Ready
  state: Ready
  currentCAPApplicationVersionInstance: test-cap-01-cav-v2
  observedGeneration: 3
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  annotations:
    sme.sap.com/resource-hash: 5f2491972f07ee993e0177615b0745404a128734a70eeee3aa1f2335de96bdc8
    sme.sap.com/owner-identifier: default.test-cap-01-provider
  labels:
    sme.sap.com/owner-generation: "3"
    sme.sap.com/owner-identifier-hash: db1f1fd7eaeb0e6407c741b7e4b2540044bcc4ec
  name: test-cap-01-provider
  namespace: default
  ownerReferences:
    - apiVersion: sme.sap.com/v1alpha1
      blockOwnerDeletion: true
      controller: true
      kind: CAPTenant
      name: test-cap-01-provider
spec:
  gateways:
    - test-cap-01-gw
    - istio-system/cap-operator-domains-gen
  hosts:
    - my-changed-provider.app-domain.test.local
    - my-changed-provider.foo.bar.local
  http:
    - match:
      - headers:
          Cookie:
            regex: (^|.*; )COP_CAV=test-cap-01-cav-v2($|; .*)
        uri:
          regex: ^|.*(logout|logoff).*
      route:
      - destination:
          host: test-cap-01-cav-v2-app-router-svc.default.svc.cluster.local
          port:
            number: 5000
        headers:
          response:
            set:
              Set-Cookie: COP_CAV=test-cap-01-cav-v2;Path=/;HttpOnly;Secure;Max-Age=0
        weight: 100
    - match:
      - headers:
          Cookie:
            regex: (^|.*; )COP_CAV=test-cap-01-cav-v2($|; .*)
      route:
      - destination:
          host: test-cap-01-cav-v2-app-router-svc.default.svc.cluster.local
          port:
            number: 5000
        weight: 100
    - route:
      - destination:
          host: test-cap-01-cav-v2-app-router-svc.default.svc.cluster.local
          port:
            number: 5000
        headers:
          response:
            add:
              Set-Cookie: COP_CAV=test-cap-01-cav-v2;Path=/;HttpOnly;Secure;Max-Age=Session
        weight: 100
---
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  annotations:
    sme.sap.com/resource-hash: ca930fa3ab9c0c67bf3d2d948cdacefd93505d6089f56ebcd7cc7cf06e66ad7d
    sme.sap.com/owner-identifier: default.test-cap-01-provider
  labels:
    sme.sap.com/owner-generation: "3"
    sme.sap.com/owner-identifier-hash: db1f1fd7eaeb0e6407c741b7e4b2540044bcc4ec
  name: test-cap-01-provider
  namespace: default
  ownerReferences:
    - apiVersion: sme.sap.com/v1alpha1
      blockOwnerDeletion: true
      controller: true
      kind: CAPTenant
      name: test-cap-01-provider
spec:
  host: test-cap-01-cav-v2-app-router-svc.default.svc.cluster.local
  trafficPolicy:
    loadBalancer:
      consistentHash:
        httpCookie:
          name: JSESSIONID
          path: /
          ttl: 0s
---
apiVersion: dns.gardener.cloud/v1alpha1
kind: DNSEntry
metadata:
  annotations:
    dns.gardener.cloud/class: garden
    sme.sap.com/resource-hash: be44dd98e914aa033f04f18a03338da45b40090b55e0e1c935353f088bd7c583
    sme.sap.com/owner-identifier: CAPTenant.default.test-cap-01-provider
  labels:
    sme.sap.com/owner-identifier-hash: ec24f9b09337c244cf5ac64b539f8c04f507cd99
  name: test-cap-01-provider0
  namespace: default
  ownerReferences:
    - apiVersion: sme.sap.com/v1alpha1
      blockOwnerDeletion: true
      controller: true
      kind: CAPTenant
      name: test-cap-01-provider
spec:
  dnsName: my-changed-provider.foo.bar.local
  targets:
    - public-ingress.operator.testing.local
